# ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ê¸°ë³¸ê°’ ì„¤ì •

## ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ê°€ ë­”ê°€ìš”?

ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ëŠ” **"URL ë’¤ì— ?ë¥¼ ë¶™ì—¬ì„œ ì „ë‹¬í•˜ëŠ” ì¶”ê°€ ì •ë³´ë“¤"**ì´ì—ìš”.

```
http://localhost:3000/products?category=electronics&page=1&limit=10
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë“¤
```

## 1. ê¸°ë³¸ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì‚¬ìš©ë²•

### req.queryë¡œ ì ‘ê·¼í•˜ê¸°

```javascript
const express = require('express');
const app = express();

app.get('/search', (req, res) => {
  console.log('ì „ì²´ ì¿¼ë¦¬:', req.query);
  
  const keyword = req.query.q;         // ê²€ìƒ‰ì–´
  const page = req.query.page;         // í˜ì´ì§€ ë²ˆí˜¸
  const limit = req.query.limit;       // í˜ì´ì§€ë‹¹ ê°œìˆ˜
  
  res.json({
    keyword: keyword,
    page: page,
    limit: limit,
    type: typeof page  // ì£¼ì˜: ëª¨ë“  ê°’ì´ ë¬¸ìì—´!
  });
});

app.listen(3000);
```

**í…ŒìŠ¤íŠ¸:**
```bash
curl "http://localhost:3000/search?q=nodejs&page=2&limit=10"
# ê²°ê³¼: { "keyword": "nodejs", "page": "2", "limit": "10", "type": "string" }
```

## 2. ê¸°ë³¸ê°’ ì„¤ì •í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•

### A) || ì—°ì‚°ì ì‚¬ìš© (ì „í†µì ì¸ ë°©ë²•)

```javascript
app.get('/products', (req, res) => {
  const category = req.query.category || 'all';
  const page = parseInt(req.query.page) || 1;
  const limit = parseInt(req.query.limit) || 20;
  const sort = req.query.sort || 'name';
  
  res.json({
    category,
    page,
    limit,
    sort
  });
});
```

### B) êµ¬ì¡°ë¶„í•´ í• ë‹¹ + ê¸°ë³¸ê°’ (ìµœì‹  ë°©ë²•)

```javascript
app.get('/products', (req, res) => {
  const {
    category = 'all',
    page = '1',
    limit = '20',
    sort = 'name',
    order = 'asc'
  } = req.query;
  
  res.json({
    category,
    page: parseInt(page),
    limit: parseInt(limit),
    sort,
    order
  });
});
```

### C) í•¨ìˆ˜ë¥¼ ì´ìš©í•œ ë°©ë²•

```javascript
// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
const getQueryParam = (query, key, defaultValue, type = 'string') => {
  const value = query[key];
  
  if (value === undefined) {
    return defaultValue;
  }
  
  switch (type) {
    case 'number':
      const num = parseInt(value);
      return isNaN(num) ? defaultValue : num;
    case 'boolean':
      return value === 'true';
    case 'array':
      return Array.isArray(value) ? value : [value];
    default:
      return value;
  }
};

app.get('/products', (req, res) => {
  const category = getQueryParam(req.query, 'category', 'all');
  const page = getQueryParam(req.query, 'page', 1, 'number');
  const limit = getQueryParam(req.query, 'limit', 20, 'number');
  const inStock = getQueryParam(req.query, 'inStock', true, 'boolean');
  const tags = getQueryParam(req.query, 'tags', [], 'array');
  
  res.json({
    category,
    page,
    limit,
    inStock,
    tags
  });
});
```

## 3. ì‹¤ì „ ì˜ˆì‹œ - ìƒí’ˆ ëª©ë¡ API

### ì™„ì „í•œ í•„í„°ë§ + ê¸°ë³¸ê°’ ì„¤ì •

```javascript
const express = require('express');
const app = express();

// ê°€ì§œ ìƒí’ˆ ë°ì´í„°
const products = [
  { id: 1, name: 'ë…¸íŠ¸ë¶', price: 1000, category: 'electronics', inStock: true, tags: ['computer', 'work'] },
  { id: 2, name: 'ë§ˆìš°ìŠ¤', price: 30, category: 'electronics', inStock: true, tags: ['computer', 'gaming'] },
  { id: 3, name: 'ì±…ìƒ', price: 200, category: 'furniture', inStock: false, tags: ['work', 'home'] },
  { id: 4, name: 'ì˜ì', price: 150, category: 'furniture', inStock: true, tags: ['work', 'comfort'] },
  { id: 5, name: 'í‚¤ë³´ë“œ', price: 80, category: 'electronics', inStock: true, tags: ['computer', 'gaming'] }
];

app.get('/products', (req, res) => {
  // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° + ê¸°ë³¸ê°’ ì„¤ì •
  const {
    category = '',           // ì¹´í…Œê³ ë¦¬ í•„í„° (ë¹ˆ ë¬¸ìì—´ = ì „ì²´)
    minPrice = '0',         // ìµœì†Œ ê°€ê²©
    maxPrice = '999999',    // ìµœëŒ€ ê°€ê²©
    inStock = '',           // ì¬ê³  ì—¬ë¶€ ('true', 'false', '' = ì „ì²´)
    search = '',            // ê²€ìƒ‰ì–´
    sort = 'name',          // ì •ë ¬ ê¸°ì¤€
    order = 'asc',          // ì •ë ¬ ìˆœì„œ
    page = '1',             // í˜ì´ì§€ ë²ˆí˜¸
    limit = '10',           // í˜ì´ì§€ë‹¹ ê°œìˆ˜
    tags = ''               // íƒœê·¸ í•„í„°
  } = req.query;
  
  // íƒ€ì… ë³€í™˜
  const pageNum = Math.max(1, parseInt(page));
  const limitNum = Math.max(1, Math.min(100, parseInt(limit))); // ìµœëŒ€ 100ê°œ ì œí•œ
  const minPriceNum = Math.max(0, parseInt(minPrice));
  const maxPriceNum = parseInt(maxPrice);
  
  // íƒœê·¸ ë°°ì—´ë¡œ ë³€í™˜
  const tagArray = tags ? tags.split(',').map(tag => tag.trim()) : [];
  
  console.log('ğŸ“Š ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë¶„ì„:');
  console.log(`  category: "${category}" (${category ? 'í•„í„° ì ìš©' : 'ì „ì²´'})`);
  console.log(`  price: ${minPriceNum} ~ ${maxPriceNum}`);
  console.log(`  inStock: "${inStock}" (${inStock ? (inStock === 'true' ? 'ì¬ê³  ìˆìŒ' : 'ì¬ê³  ì—†ìŒ') : 'ì „ì²´'})`);
  console.log(`  search: "${search}" (${search ? 'ê²€ìƒ‰ ì ìš©' : 'ê²€ìƒ‰ ì—†ìŒ'})`);
  console.log(`  sort: ${sort} ${order}`);
  console.log(`  page: ${pageNum}, limit: ${limitNum}`);
  console.log(`  tags: [${tagArray.join(', ')}]`);
  
  let filteredProducts = [...products];
  
  // 1. ì¹´í…Œê³ ë¦¬ í•„í„°
  if (category) {
    filteredProducts = filteredProducts.filter(p => p.category === category);
    console.log(`ì¹´í…Œê³ ë¦¬ í•„í„° í›„: ${filteredProducts.length}ê°œ`);
  }
  
  // 2. ê°€ê²© í•„í„°
  filteredProducts = filteredProducts.filter(p => 
    p.price >= minPriceNum && p.price <= maxPriceNum
  );
  console.log(`ê°€ê²© í•„í„° í›„: ${filteredProducts.length}ê°œ`);
  
  // 3. ì¬ê³  í•„í„°
  if (inStock === 'true') {
    filteredProducts = filteredProducts.filter(p => p.inStock === true);
    console.log(`ì¬ê³  í•„í„° í›„: ${filteredProducts.length}ê°œ`);
  } else if (inStock === 'false') {
    filteredProducts = filteredProducts.filter(p => p.inStock === false);
    console.log(`ì¬ê³  í•„í„° í›„: ${filteredProducts.length}ê°œ`);
  }
  
  // 4. ê²€ìƒ‰ í•„í„°
  if (search) {
    const searchLower = search.toLowerCase();
    filteredProducts = filteredProducts.filter(p =>
      p.name.toLowerCase().includes(searchLower) ||
      p.category.toLowerCase().includes(searchLower)
    );
    console.log(`ê²€ìƒ‰ í•„í„° í›„: ${filteredProducts.length}ê°œ`);
  }
  
  // 5. íƒœê·¸ í•„í„°
  if (tagArray.length > 0) {
    filteredProducts = filteredProducts.filter(p =>
      tagArray.some(tag => p.tags.includes(tag))
    );
    console.log(`íƒœê·¸ í•„í„° í›„: ${filteredProducts.length}ê°œ`);
  }
  
  // 6. ì •ë ¬
  filteredProducts.sort((a, b) => {
    let aValue, bValue;
    
    switch (sort) {
      case 'price':
        aValue = a.price;
        bValue = b.price;
        break;
      case 'name':
        aValue = a.name.toLowerCase();
        bValue = b.name.toLowerCase();
        break;
      default:
        aValue = a.name.toLowerCase();
        bValue = b.name.toLowerCase();
    }
    
    if (order === 'desc') {
      return aValue < bValue ? 1 : aValue > bValue ? -1 : 0;
    } else {
      return aValue > bValue ? 1 : aValue < bValue ? -1 : 0;
    }
  });
  
  // 7. í˜ì´ì§•
  const totalItems = filteredProducts.length;
  const totalPages = Math.ceil(totalItems / limitNum);
  const startIndex = (pageNum - 1) * limitNum;
  const endIndex = startIndex + limitNum;
  const paginatedProducts = filteredProducts.slice(startIndex, endIndex);
  
  // 8. ì‘ë‹µ
  res.json({
    success: true,
    data: paginatedProducts,
    pagination: {
      current: pageNum,
      total: totalPages,
      limit: limitNum,
      count: paginatedProducts.length,
      totalItems: totalItems
    },
    filters: {
      category: category || 'ì „ì²´',
      priceRange: { min: minPriceNum, max: maxPriceNum },
      inStock: inStock || 'ì „ì²´',
      search: search || 'ì—†ìŒ',
      tags: tagArray.length > 0 ? tagArray : 'ì—†ìŒ'
    },
    sort: {
      field: sort,
      order: order
    }
  });
});

app.listen(3000, () => {
  console.log('ìƒí’ˆ API ì„œë²„ê°€ 3000ë²ˆ í¬íŠ¸ì—ì„œ ì‹¤í–‰ì¤‘ì…ë‹ˆë‹¤.');
});
```

## 4. ë‹¤ì–‘í•œ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì˜ˆì‹œë“¤

```bash
# 1. ê¸°ë³¸ (ëª¨ë“  ê¸°ë³¸ê°’ ì‚¬ìš©)
curl "http://localhost:3000/products"

# 2. ì¹´í…Œê³ ë¦¬ í•„í„°
curl "http://localhost:3000/products?category=electronics"

# 3. ê°€ê²© ë²”ìœ„
curl "http://localhost:3000/products?minPrice=50&maxPrice=200"

# 4. ì¬ê³  ìˆëŠ” ìƒí’ˆë§Œ
curl "http://localhost:3000/products?inStock=true"

# 5. ê²€ìƒ‰
curl "http://localhost:3000/products?search=ë…¸íŠ¸"

# 6. ì •ë ¬
curl "http://localhost:3000/products?sort=price&order=desc"

# 7. í˜ì´ì§•
curl "http://localhost:3000/products?page=2&limit=2"

# 8. íƒœê·¸ í•„í„°
curl "http://localhost:3000/products?tags=computer,gaming"

# 9. ë³µí•© í•„í„°
curl "http://localhost:3000/products?category=electronics&minPrice=50&inStock=true&sort=price&order=asc&page=1&limit=5"
```

## 5. ê³ ê¸‰ ê¸°ë³¸ê°’ ì„¤ì • íŒ¨í„´

### A) ì„¤ì • ê°ì²´ íŒ¨í„´

```javascript
const defaultConfig = {
  pagination: {
    page: 1,
    limit: 20,
    maxLimit: 100
  },
  filters: {
    category: '',
    inStock: '',
    search: ''
  },
  sort: {
    field: 'name',
    order: 'asc',
    allowedFields: ['name', 'price', 'createdAt']
  }
};

app.get('/products', (req, res) => {
  // ì„¤ì •ê³¼ ì¿¼ë¦¬ ë³‘í•©
  const config = {
    page: Math.max(1, parseInt(req.query.page) || defaultConfig.pagination.page),
    limit: Math.min(
      defaultConfig.pagination.maxLimit,
      Math.max(1, parseInt(req.query.limit) || defaultConfig.pagination.limit)
    ),
    category: req.query.category || defaultConfig.filters.category,
    inStock: req.query.inStock || defaultConfig.filters.inStock,
    search: req.query.search || defaultConfig.filters.search,
    sort: defaultConfig.sort.allowedFields.includes(req.query.sort) 
      ? req.query.sort 
      : defaultConfig.sort.field,
    order: ['asc', 'desc'].includes(req.query.order) 
      ? req.query.order 
      : defaultConfig.sort.order
  };
  
  res.json({ config });
});
```

### B) ë¯¸ë“¤ì›¨ì–´ íŒ¨í„´

```javascript
// ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì •ê·œí™” ë¯¸ë“¤ì›¨ì–´
const normalizeQuery = (req, res, next) => {
  // ê¸°ë³¸ê°’ ì„¤ì •
  req.query.page = Math.max(1, parseInt(req.query.page) || 1);
  req.query.limit = Math.max(1, Math.min(100, parseInt(req.query.limit) || 20));
  req.query.sort = req.query.sort || 'name';
  req.query.order = ['asc', 'desc'].includes(req.query.order) ? req.query.order : 'asc';
  
  // ë¶ˆë¦° ê°’ ë³€í™˜
  if (req.query.inStock !== undefined) {
    req.query.inStock = req.query.inStock === 'true';
  }
  
  // ë°°ì—´ ë³€í™˜
  if (req.query.tags) {
    req.query.tags = req.query.tags.split(',').map(tag => tag.trim());
  }
  
  next();
};

// ë¯¸ë“¤ì›¨ì–´ ì‚¬ìš©
app.get('/products', normalizeQuery, (req, res) => {
  // req.queryëŠ” ì´ë¯¸ ì •ê·œí™”ë¨
  res.json({
    query: req.query,
    message: 'ì •ê·œí™”ëœ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°'
  });
});
```

## 6. ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ìœ íš¨ì„± ê²€ì‚¬

### ì…ë ¥ê°’ ê²€ì¦í•˜ê¸°

```javascript
const validateQuery = (req, res, next) => {
  const errors = [];
  
  // í˜ì´ì§€ ë²ˆí˜¸ ê²€ì¦
  const page = parseInt(req.query.page);
  if (req.query.page && (isNaN(page) || page < 1)) {
    errors.push('pageëŠ” 1 ì´ìƒì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤');
  }
  
  // ì œí•œ ê°œìˆ˜ ê²€ì¦
  const limit = parseInt(req.query.limit);
  if (req.query.limit && (isNaN(limit) || limit < 1 || limit > 100)) {
    errors.push('limitëŠ” 1~100 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤');
  }
  
  // ê°€ê²© ê²€ì¦
  const minPrice = parseInt(req.query.minPrice);
  const maxPrice = parseInt(req.query.maxPrice);
  if (req.query.minPrice && isNaN(minPrice)) {
    errors.push('minPriceëŠ” ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤');
  }
  if (req.query.maxPrice && isNaN(maxPrice)) {
    errors.push('maxPriceëŠ” ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤');
  }
  if (!isNaN(minPrice) && !isNaN(maxPrice) && minPrice > maxPrice) {
    errors.push('minPriceëŠ” maxPriceë³´ë‹¤ ì‘ì•„ì•¼ í•©ë‹ˆë‹¤');
  }
  
  // ì •ë ¬ í•„ë“œ ê²€ì¦
  const allowedSortFields = ['name', 'price', 'createdAt'];
  if (req.query.sort && !allowedSortFields.includes(req.query.sort)) {
    errors.push(`sortëŠ” ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤: ${allowedSortFields.join(', ')}`);
  }
  
  // ì •ë ¬ ìˆœì„œ ê²€ì¦
  if (req.query.order && !['asc', 'desc'].includes(req.query.order)) {
    errors.push('orderëŠ” asc ë˜ëŠ” descì—¬ì•¼ í•©ë‹ˆë‹¤');
  }
  
  if (errors.length > 0) {
    return res.status(400).json({
      success: false,
      message: 'ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì˜¤ë¥˜',
      errors: errors
    });
  }
  
  next();
};

app.get('/products', validateQuery, (req, res) => {
  res.json({ message: 'ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼!' });
});
```

## 7. ì‹¤ìŠµ ê³¼ì œ

ë‹¤ìŒ ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” APIë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”:

```javascript
// ë„ì„œ ê²€ìƒ‰ API
// GET /books?query=ê²€ìƒ‰ì–´&author=ì‘ê°€&year=ì¶œíŒë…„ë„&page=í˜ì´ì§€&limit=ê°œìˆ˜&sort=ì •ë ¬ê¸°ì¤€&order=ì •ë ¬ìˆœì„œ

const books = [
  { id: 1, title: 'JavaScript ì™„ë²½ ê°€ì´ë“œ', author: 'ê¹€ê°œë°œ', year: 2023, pages: 500 },
  { id: 2, title: 'Node.js ë§ˆìŠ¤í„°í•˜ê¸°', author: 'ì´ë°±ì—”ë“œ', year: 2024, pages: 300 },
  { id: 3, title: 'React ì‹¤ì „ í”„ë¡œì íŠ¸', author: 'ë°•í”„ë¡ íŠ¸', year: 2023, pages: 400 },
  { id: 4, title: 'Docker ì…ë¬¸', author: 'ìµœë°ë¸Œì˜µìŠ¤', year: 2022, pages: 250 }
];

app.get('/books', (req, res) => {
  // TODO: ë‹¤ìŒ ê¸°ë³¸ê°’ë“¤ì„ ì„¤ì •í•˜ì„¸ìš”
  // query: '' (ê²€ìƒ‰ì–´)
  // author: '' (ì‘ê°€ í•„í„°)
  // year: '' (ì¶œíŒë…„ë„ í•„í„°)
  // minPages: 0 (ìµœì†Œ í˜ì´ì§€)
  // maxPages: 9999 (ìµœëŒ€ í˜ì´ì§€)
  // page: 1 (í˜ì´ì§€ ë²ˆí˜¸)
  // limit: 10 (í˜ì´ì§€ë‹¹ ê°œìˆ˜, ìµœëŒ€ 50)
  // sort: 'title' (ì •ë ¬ ê¸°ì¤€: title, author, year, pages)
  // order: 'asc' (ì •ë ¬ ìˆœì„œ: asc, desc)
  
  // TODO: í•„í„°ë§, ì •ë ¬, í˜ì´ì§• êµ¬í˜„
  
  res.json({
    success: true,
    data: [], // í•„í„°ë§ëœ ë„ì„œ ëª©ë¡
    pagination: {}, // í˜ì´ì§• ì •ë³´
    filters: {} // ì ìš©ëœ í•„í„° ì •ë³´
  });
});
```

## í•µì‹¬ ì •ë¦¬

**ê¸°ë³¸ê°’ ì„¤ì • ë°©ë²•:**
1. **|| ì—°ì‚°ì**: `const page = req.query.page || 1`
2. **êµ¬ì¡°ë¶„í•´ í• ë‹¹**: `const { page = 1 } = req.query`
3. **ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜**: `getQueryParam(req.query, 'page', 1, 'number')`
4. **ë¯¸ë“¤ì›¨ì–´**: ì¿¼ë¦¬ ì •ê·œí™” ë¯¸ë“¤ì›¨ì–´ ì‚¬ìš©

**ì£¼ì˜ì‚¬í•­:**
- ëª¨ë“  ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ëŠ” **ë¬¸ìì—´**ë¡œ ë“¤ì–´ì˜´
- ìˆ«ì ë³€í™˜ì‹œ `parseInt()` ì‚¬ìš©
- ë¶ˆë¦° ë³€í™˜ì‹œ `=== 'true'` ë¹„êµ
- ìµœì†Œ/ìµœëŒ€ê°’ ì œí•œ ì„¤ì •
- í—ˆìš©ëœ ê°’ë§Œ ì‚¬ìš©í•˜ë„ë¡ ê²€ì¦

**ì‹¤ë¬´ íŒ:**
- ê¸°ë³¸ê°’ì€ í•©ë¦¬ì ìœ¼ë¡œ ì„¤ì • (page=1, limit=20 ë“±)
- ìµœëŒ€ ì œí•œê°’ ì„¤ì •ìœ¼ë¡œ ì„±ëŠ¥ ë³´í˜¸
- ìœ íš¨ì„± ê²€ì‚¬ë¡œ ì˜ëª»ëœ ì…ë ¥ ì°¨ë‹¨
- ì„¤ì • ê°ì²´ë‚˜ ë¯¸ë“¤ì›¨ì–´ë¡œ ì¬ì‚¬ìš©ì„± í–¥ìƒ